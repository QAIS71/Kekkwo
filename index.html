<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاكاة الأرض الواقعية</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        canvas { display: block; }
        #loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 20px;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
            pointer-events: none; /* يسمح بالضغط خلفه */
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="loading">جاري تحميل مجسمات الأرض...<br><small>يرجى الانتظار قليلاً</small></div>

    <!-- مكتبة Three.js الأساسية -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- مكتبة التحكم بالكاميرا -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // المتغيرات الأساسية
        let scene, camera, renderer, controls;
        let earthMesh, cloudsMesh, starField;

        function init() {
            // 1. إنشاء المشهد
            scene = new THREE.Scene();

            // 2. الكاميرا
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 18); // وضع الكاميرا

            // 3. الريندر (الرسام)
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 4. التحكم بالماوس
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enablePan = false;
            controls.minDistance = 5;
            controls.maxDistance = 50;

            // 5. الإضاءة
            // ضوء محيطي خافت
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            // ضوء الشمس (نقطي قوي)
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
            sunLight.position.set(50, 30, 50);
            scene.add(sunLight);

            // 6. تحميل الصور (Textures)
            const loader = new THREE.TextureLoader();
            // تفعيل السماح بالمصادر الخارجية
            loader.crossOrigin = 'anonymous';

            // روابط الصور من مصادر موثوقة (Github - Three.js examples)
            const earthMap = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg';
            const earthSpecular = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg';
            const earthNormal = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_normal_2048.jpg';
            const cloudsMap = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png';

            // --- بناء الأرض ---
            const geometry = new THREE.SphereGeometry(5, 64, 64);
            const material = new THREE.MeshPhongMaterial({
                map: loader.load(earthMap, undefined, undefined, function(err) { console.error("خطأ في تحميل صورة الأرض"); }),
                specularMap: loader.load(earthSpecular),
                normalMap: loader.load(earthNormal),
                specular: new THREE.Color(0x333333),
                shininess: 15
            });

            // إضافة لون أزرق احتياطي في حال فشل التحميل
            material.color = new THREE.Color(0xffffff); 

            earthMesh = new THREE.Mesh(geometry, material);
            scene.add(earthMesh);

            // --- بناء الغيوم ---
            const cloudGeo = new THREE.SphereGeometry(5.1, 64, 64);
            const cloudMat = new THREE.MeshLambertMaterial({
                map: loader.load(cloudsMap),
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending,
                side: THREE.DoubleSide
            });
            cloudsMesh = new THREE.Mesh(cloudGeo, cloudMat);
            scene.add(cloudsMesh);

            // --- بناء النجوم (برمجياً لضمان العمل) ---
            createStars();

            // إخفاء رسالة التحميل بعد ثانيتين (لضمان تحميل الصور)
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 2500);

            // بدء الحركة
            animate();
        }

        function createStars() {
            // إنشاء 3000 نجمة بشكل عشوائي
            const starsGeometry = new THREE.BufferGeometry();
            const starsCount = 3000;
            const posArray = new Float32Array(starsCount * 3);

            for(let i = 0; i < starsCount * 3; i++) {
                // توزيع النجوم في مساحة كبيرة جداً
                posArray[i] = (Math.random() - 0.5) * 200; 
            }

            starsGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

            const starsMaterial = new THREE.PointsMaterial({
                size: 0.15,
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });

            starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        function animate() {
            requestAnimationFrame(animate);

            // تدوير الأرض
            if (earthMesh) earthMesh.rotation.y += 0.0015;
            
            // تدوير الغيوم (أسرع قليلاً)
            if (cloudsMesh) {
                cloudsMesh.rotation.y += 0.0020;
                cloudsMesh.rotation.z += 0.0001;
            }

            // تدوير النجوم ببطء شديد
            if (starField) starField.rotation.y -= 0.0002;

            controls.update();
            renderer.render(scene, camera);
        }

        // تعديل الحجم عند تغيير النافذة
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // تشغيل الكود
        init();
    </script>
</body>
</html>
