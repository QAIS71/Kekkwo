<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صورتك في الفضاء - محطة ناسا</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #000; }
        
        /* واجهة المستخدم فوق الـ 3D */
        #ui-container {
            position: absolute;
            top: 0; right: 0; width: 100%; height: 100%;
            pointer-events: none; /* يسمح بالنقر على الـ 3D */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .controls {
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            max-width: 300px;
            border: 1px solid #444;
        }

        button, input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        button { background: #007bff; color: white; font-weight: bold; }
        button:hover { background: #0056b3; }
        
        /* مكان الإعلانات */
        #adsense-banner {
            pointer-events: auto;
            background: white;
            width: 728px;
            height: 90px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
        }

        /* قائمة اللغات */
        #lang-select {
            pointer-events: auto;
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 5px;
        }

        /* رسالة التحميل */
        #loading {
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            color: white; font-size: 24px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="loading">جاري تحميل المحطة الفضائية...</div>

    <div id="ui-container">
        
        <select id="lang-select" onchange="changeLanguage()">
            <option value="ar">العربية</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
            </select>

        <div class="controls">
            <h2 id="title-text">ارفع صورتك للمحطة</h2>
            <p id="desc-text">ستظهر صورتك على شاشة المحطة الفضائية وتدور حول الأرض.</p>
            <input type="file" id="imageUpload" accept="image/*">
            <button onclick="takeSnapshot()" id="btn-snap">التقاط صورة عالية الدقة</button>
        </div>

        <div id="adsense-banner">
            مساحة إعلانية (Google AdSense)
        </div>
    </div>

    <script>
        // 1. إعداد المشهد (Scene Setup)
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true }); // preserveDrawingBuffer مهم لالتقاط الصورة
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. إضاءة المشهد
        const ambientLight = new THREE.AmbientLight(0x333333);
        scene.add(ambientLight);
        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(5, 3, 5);
        scene.add(sunLight);

        // 3. إنشاء الأرض (Earth)
        // ملاحظة: للحصول على شكل حقيقي تحتاج لصور Texture حقيقية
        const earthGeometry = new THREE.SphereGeometry(5, 64, 64);
        const earthMaterial = new THREE.MeshPhongMaterial({
            map: new THREE.TextureLoader().load('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Earth_DaN_visible_2048x1024.jpg/1024px-Earth_DaN_visible_2048x1024.jpg'),
            bumpScale: 0.05,
            specular: new THREE.Color('grey'),
        });
        const earth = new THREE.Mesh(earthGeometry, earthMaterial);
        scene.add(earth);

        // 4. النجوم (Stars Background)
        const starGeometry = new THREE.BufferGeometry();
        const starMaterial = new THREE.PointsMaterial({color: 0xffffff});
        const starVertices = [];
        for(let i=0; i<10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x,y,z);
        }
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        // 5. المحطة والشاشة (Station Screen)
        // هنا نقوم بعمل نموذج بسيط، في الواقع يجب استبداله بموديل GLTF للمحطة الحقيقية
        const stationGroup = new THREE.Group();
        
        // إطار الشاشة
        const frameGeo = new THREE.BoxGeometry(3.2, 2.2, 0.1);
        const frameMat = new THREE.MeshLambertMaterial({ color: 0x888888 });
        const frame = new THREE.Mesh(frameGeo, frameMat);
        
        // الشاشة نفسها (حيث ستظهر الصورة)
        const screenGeo = new THREE.PlaneGeometry(3, 2);
        const screenMat = new THREE.MeshBasicMaterial({ color: 0x000000 }); // لون أسود مبدئياً
        const screenMesh = new THREE.Mesh(screenGeo, screenMat);
        screenMesh.position.z = 0.06; // تبرز قليلاً للأمام

        stationGroup.add(frame);
        stationGroup.add(screenMesh);
        
        // وضع المحطة في مدار
        stationGroup.position.set(0, 0, 8); // مسافة قريبة من الكاميرا
        scene.add(stationGroup);

        // إخفاء رسالة التحميل
        document.getElementById('loading').style.display = 'none';

        // موقع الكاميرا
        camera.position.set(0, 0, 12);
        
        // أدوات التحكم بالماوس (OrbitControls)
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // 6. منطق رفع الصورة (Image Upload Logic)
        const imageUpload = document.getElementById('imageUpload');
        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = function() {
                        const texture = new THREE.Texture(img);
                        texture.needsUpdate = true;
                        screenMesh.material.map = texture;
                        screenMesh.material.needsUpdate = true;
                        screenMesh.material.color.set(0xffffff); // إعادة اللون للأبيض ليظهر التكستشر
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // 7. منطق التقاط الصورة (Snapshot Logic)
        function takeSnapshot() {
            // إخفاء واجهة المستخدم مؤقتاً
            const ui = document.getElementById('ui-container');
            ui.style.display = 'none';
            
            renderer.render(scene, camera);
            
            // تحويل الـ Canvas لصورة
            setTimeout(() => {
                const dataURL = renderer.domElement.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'my-photo-in-space.png';
                link.href = dataURL;
                link.click();
                
                // إعادة إظهار الواجهة
                ui.style.display = 'flex';
            }, 100);
        }

        // 8. منطق اللغات (Localization)
        const translations = {
            ar: { title: "ارفع صورتك للمحطة", desc: "ستظهر صورتك على شاشة المحطة الفضائية.", btn: "التقاط صورة" },
            en: { title: "Upload Photo to ISS", desc: "Your photo will appear on the station screen.", btn: "Take Snapshot" },
            fr: { title: "Télécharger une photo", desc: "Votre photo apparaîtra sur l'écran.", btn: "Prendre une photo" },
            // أضف المزيد هنا
        };

        function changeLanguage() {
            const lang = document.getElementById('lang-select').value;
            const t = translations[lang] || translations['en'];
            document.getElementById('title-text').innerText = t.title;
            document.getElementById('desc-text').innerText = t.desc;
            document.getElementById('btn-snap').innerText = t.btn;
            document.body.dir = (lang === 'ar') ? 'rtl' : 'ltr';
        }

        // حلقة الرسم (Animation Loop)
        function animate() {
            requestAnimationFrame(animate);
            
            // تدوير الأرض ببطء
            earth.rotation.y += 0.0005;
            
            // تدوير المحطة ببطء لتبدو واقعية
            stationGroup.rotation.z += 0.0002;
            stationGroup.rotation.y += 0.001;

            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // تجاوب الشاشة عند تغيير الحجم
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
