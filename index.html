<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙŠÙ„ÙÙŠ Ù…Ø­Ø·Ø© Ø§Ù„ÙØ¶Ø§Ø¡</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        #ui-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            background: linear-gradient(45deg, #00aaff, #0066cc);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.4);
        }

        .btn-capture {
            background: linear-gradient(45deg, #ff4444, #cc0000);
        }

        .btn-capture:hover {
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: white;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        #file-input { display: none; }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© */
        .icon { font-size: 1.2em; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loader {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #00aaff;
            z-index: 999;
            transition: opacity 0.5s;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="loader">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚...</div>

    <div id="info">
        <h1>Ø³ÙŠÙ„ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡</h1>
        <p>Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ù„ØªØ¸Ù‡Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ø­Ø·Ø©ØŒ Ø«Ù… Ø§Ù„ØªÙ‚Ø· Ø§Ù„ØµÙˆØ±Ø©!</p>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="ui-container">
        <input type="file" id="file-input" accept="image/*">
        <button class="btn" onclick="document.getElementById('file-input').click()">
            <span class="icon">ğŸ“·</span> Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ
        </button>
        <button class="btn btn-capture" id="save-btn">
            <span class="icon">ğŸ“¸</span> Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ­ÙØ¸
        </button>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ù‡Ø¯ ---
        const scene = new THREE.Scene();
        
        // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);

        // Ø§Ù„Ø±ÙŠÙ†Ø¯Ø± (Ù…Ø¹ ØªÙØ¹ÙŠÙ„ preserveDrawingBuffer Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±)
        const renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true, 
            preserveDrawingBuffer: true 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 2;
        controls.maxDistance = 10;

        // --- Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 2.0);
        scene.add(ambientLight);
        
        const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
        sunLight.position.set(5, 3, 5);
        scene.add(sunLight);

        // --- Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ---
        const manager = new THREE.LoadingManager();
        manager.onLoad = () => {
            const loader = document.getElementById('loader');
            loader.style.opacity = 0;
            setTimeout(() => loader.remove(), 500);
        };
        const textureLoader = new THREE.TextureLoader(manager);

        // --- Ø§Ù„Ø£Ø±Ø¶ ---
        const earthGroup = new THREE.Group();
        scene.add(earthGroup);

        const earthMesh = new THREE.Mesh(
            new THREE.SphereGeometry(1, 64, 64),
            new THREE.MeshPhongMaterial({
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg'),
                specularMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg'),
                normalMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_normal_2048.jpg'),
                shininess: 5
            })
        );
        earthGroup.add(earthMesh);

        const cloudMesh = new THREE.Mesh(
            new THREE.SphereGeometry(1.02, 64, 64),
            new THREE.MeshPhongMaterial({
                map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png'),
                transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending, side: THREE.DoubleSide
            })
        );
        earthGroup.add(cloudMesh);

        const atmosphere = new THREE.Mesh(
            new THREE.SphereGeometry(1.15, 64, 64),
            new THREE.ShaderMaterial({
                vertexShader: `varying vec3 vNormal; void main() { vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
                fragmentShader: `varying vec3 vNormal; void main() { float intensity = pow(0.6 - dot(vNormal, vec3(0, 0, 1.0)), 3.0); gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity; }`,
                blending: THREE.AdditiveBlending, side: THREE.BackSide, transparent: true
            })
        );
        earthGroup.add(atmosphere);

        // --- Ø§Ù„Ù†Ø¬ÙˆÙ… ---
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];
        for(let i=0; i<3000; i++) starPos.push((Math.random()-0.5)*2000, (Math.random()-0.5)*2000, (Math.random()-0.5)*2000);
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 2}));
        scene.add(stars);

        // --- Ù…Ø­Ø·Ø© Ø§Ù„ÙØ¶Ø§Ø¡ (GLB) ---
        const gltfLoader = new GLTFLoader(manager);
        let station;
        const stationOrbit = new THREE.Group();
        scene.add(stationOrbit);

        // ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ion Drive ÙƒØ¨Ø¯ÙŠÙ„ Ø¬ÙŠØ¯ Ù„Ù„Ù…Ø­Ø·Ø©
        gltfLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/models/gltf/PrimaryIonDrive.glb', (gltf) => {
            station = gltf.scene;
            station.scale.set(0.1, 0.1, 0.1);
            station.position.set(1.5, 0, 0); // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶
            station.rotation.set(Math.PI/2, Math.PI/2, 0);
            stationOrbit.add(station);
            
            // Ø¶ÙˆØ¡ Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø­Ø·Ø©
            const light = new THREE.PointLight(0x00aaff, 1, 3);
            light.position.set(1.5, 0.5, 0);
            stationOrbit.add(light);
        });

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ÙŠÙ„ÙÙŠ (ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…) ---
        // Ø³Ù†Ø¶ÙŠÙ Ø§Ù„ØµÙˆØ±Ø© ÙƒÙ…Ø¬Ù…ÙˆØ¹Ø© ØªØ§Ø¨Ø¹Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø­ØªÙ‰ ØªØªØ­Ø±Ùƒ Ù…Ø¹Ù‡Ø§
        const selfieGroup = new THREE.Group();
        camera.add(selfieGroup); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        scene.add(camera); // ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù…Ø´Ù‡Ø¯ Ù„ÙƒÙŠ ØªØ¸Ù‡Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§

        // Ø¥Ø·Ø§Ø± Ø§Ù„Ø³ÙŠÙ„ÙÙŠ (Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹ Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ÙŠØ±ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø©)
        let selfieMesh;
        const selfieGeometry = new THREE.PlaneGeometry(1.2, 1.6); // Ù†Ø³Ø¨Ø© Ø·ÙˆÙ„ÙŠØ©
        // Ù…Ø§Ø¯Ø© Ø´ÙØ§ÙØ© Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
        const selfieMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xffffff, 
            transparent: true, 
            opacity: 0,
            side: THREE.DoubleSide
        });
        
        selfieMesh = new THREE.Mesh(selfieGeometry, selfieMaterial);
        
        // ÙˆØ¶Ø¹ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø© (Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§)
        // Z: Ø§Ù„Ù…Ø³Ø§ÙØ© Ø£Ù…Ø§Ù… Ø§Ù„Ø¹Ø¯Ø³Ø© (Ø³Ø§Ù„Ø¨ ÙŠØ¹Ù†ÙŠ Ù„Ù„Ø£Ù…Ø§Ù… ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§)
        // X, Y: Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± ÙˆÙÙˆÙ‚/ØªØ­Øª
        selfieMesh.position.set(1.2, -0.8, -3); 
        selfieMesh.rotation.set(-0.1, -0.2, 0); // Ù…ÙŠÙ„Ø§Ù† Ø¨Ø³ÙŠØ· Ù„ØªØ¨Ø¯Ùˆ Ù…Ù…Ø³ÙˆÙƒØ© Ø¨Ø§Ù„ÙŠØ¯
        selfieGroup.add(selfieMesh);

        // --- Ù…Ù†Ø·Ù‚ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ---
        const fileInput = document.getElementById('file-input');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const userTexture = new THREE.Texture(img);
                        userTexture.colorSpace = THREE.SRGBColorSpace;
                        userTexture.needsUpdate = true;
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø©
                        selfieMaterial.map = userTexture;
                        selfieMaterial.opacity = 1;
                        selfieMaterial.needsUpdate = true;
                        
                        // ØªØ¹Ø¯ÙŠÙ„ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù„ÙˆØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙ…Ø·ÙŠ
                        const aspect = img.width / img.height;
                        selfieMesh.scale.set(aspect > 1 ? 1 : aspect, aspect > 1 ? 1/aspect : 1, 1);
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© (Screenshot) ---
        document.getElementById('save-btn').addEventListener('click', () => {
            // 1. Ø±ÙŠÙ†Ø¯Ø± Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            renderer.render(scene, camera);
            // 2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ù„ØµÙˆØ±Ø©
            const dataURL = renderer.domElement.toDataURL('image/png');
            // 3. Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ ÙˆÙ‡Ù…ÙŠ
            const link = document.createElement('a');
            link.download = 'space-selfie.png';
            link.href = dataURL;
            link.click();
        });

        // --- Ø§Ù„ØªØ­Ø±ÙŠÙƒ ---
        function animate() {
            requestAnimationFrame(animate);

            // ØªØ¯ÙˆÙŠØ± Ø§Ù„ÙƒÙˆÙƒØ¨
            earthMesh.rotation.y += 0.0005;
            cloudMesh.rotation.y += 0.0006;
            
            // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù…Ø­Ø·Ø© Ø­ÙˆÙ„ Ø§Ù„Ø£Ø±Ø¶
            stationOrbit.rotation.y += 0.002;
            stationOrbit.rotation.z = Math.sin(Date.now() * 0.0002) * 0.1;
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³ÙŠÙ„ÙÙŠ "Ø¨Ø´ÙƒÙ„ Ø·ÙÙŠÙ" ÙƒØ£Ù† Ø§Ù„ÙŠØ¯ ØªÙ‡ØªØ² ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ (ØªÙ†ÙØ³)
            if (selfieMesh.visible) {
                selfieMesh.position.y = -0.8 + Math.sin(Date.now() * 0.001) * 0.01;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>

